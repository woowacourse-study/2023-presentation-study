## 주제 선정 이유

- 지연 로딩 시 프록시 객체로 넘어오는 것은 알겠다!
- 그리고 프록시 객체는 getter 수행 시 실제로 조회를 진행하는 것도 알겠다!
- 그런데 프록시 객체가 뭐야?
    - 모르겠다!

## 프록시란?

### 프록시가 필요한 경우

- 엔티티 하나를 조회할 때 해당 엔티티 혹은 연관 관계로 매핑되어 있는 다른 엔티티를 실제 사용할 때까지 조회를 미루고 싶은 경우가 있을 수 있음
- 이때, JPA는 DB에서 조회를 하지 않고 이에 따라 실제 엔티티 객체도 생성하지 않음
    
    → 대신 DB 접근을 위임한 프록시 객체를 반환함
    

### 프록시의 특징은?

<img width="200" alt="image" src="https://github.com/woowacourse-study/2023-presentation-study/assets/63184334/350e1ab5-ced5-4fac-9d43-d5e1fe8caaca">

- 프록시 클래스는 실제 클래스를 상속 받아 만들어져 실제 클래스와 겉모양이 같음
- 사용자 입장에서는 진짜 객체인지 프록시 객체인지 구부하지 않고 사용하면 됨
- 프록시 객체는 실제 객체에 대한 참조(target)를 보관함
- 프록시 객체의 메소드가 호출되면 프록시 객체는 실제 객체의 메소드를 호출함

<img width="348" alt="image" src="https://github.com/woowacourse-study/2023-presentation-study/assets/63184334/0bf281f8-5b14-45e3-8143-440b244dccf0">

### 프록시 객체 초기화 방법

- 프록시 객체는 실제 사용될 때 DB를 조회해 실제 엔티티 객체를 생성함
    
    → 이것이 프록시 객체 초기화
    

<img width="600" alt="image" src="https://github.com/woowacourse-study/2023-presentation-study/assets/63184334/92edd04b-f639-4680-b687-e1b82c8a3e64">

****************************초기화 과정****************************

1. 프록시 객체에 member.getName()을 호출해 실제 데이터 조회
2. 프록시 객체는 실제 엔티티가 생성되어 있지 않으면 영속성 컨텍스트에 실제 엔티티 생성을 요청함 (초기화)
3. 영속성 컨텍스트는 DB를 조회해 실제 엔티티 객체를 생성함
4. 프록시 객체는 생성된 실제 엔티티 객체의 참조를 Member target 멤버 변수에 보관함
5. 프록시 객체는 실제 엔티티 객체의 getName()을 호출해 결과를 반환함

### 프록시 특징

- 프록시 객체는 처음 사용할 때 한 번만 초기화 됨
- 프록시 객체를 초기화한다고 해당 객체가 실제 엔티티로 바뀌는 것은 아님
    - 프록시 객체가 초기화되면 프록시 객체를 통해 실제 엔티티에 접근할 수 있을뿐
- 프록시 객체는 원본 엔티티를 상속받은 객체로 타입 체크 시에 주의해야 함
- 영속성 컨텍스트에 찾는 엔티티가 이미 있다면 DB를 조회할 필요가 없으므로 fetchtype을 lazy로 설정하더라도 프록시가 아닌 실제 엔티티를 반환함
- 초기화는 영속성 컨텍스트의 도움을 받아야 가능함
    - 준영속 상태의 프록시를 초기화하면 문제가 발생해 예외를 발생시킴 (영속성 컨텍스트의 도움을 받을 수 없기에)
    → `org.hibernate.LazyInitializationException`

### 프록시와 식별자

- 엔티티를 프록시로 조회할 떄 식별자 값을 파라미터로 전달함
    
    → 프록시 객체는 이 식별자 값을 보관함
    
- 프록시 객체는 식별자 값을 갖고 있어 식별자 값을 조회하는 메서드(`getId()`)를 호출하더라도 프록시를 초기화하지 않음
    - 엔티티 접근 방식으로 프로퍼티로 설정한 경우만 초기화하지 않음
        
        `@Access(AccessType.PROPERTY())`
        
    - 엔티티 접근 방식으로 필드로 설정한 경우 JPA는 `getId()` 메서드가 id만 조회하는 메서드인지 다른 필드까지 활용해 어떤 일을 하는 메서드인지 알지 못해 객체를 초기화함
        
        `@Access(AccessType.FIELD))`

### 참고 자료
자바 ORM 표준 JPA 프로그래밍 - 김영한 저
